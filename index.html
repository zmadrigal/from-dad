<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <title>From Dad</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="manifest" href="manifest.json">
    <style>
      html, body { height:100%; margin:0; }
      body { background:#000; display:flex; align-items:center; justify-content:center; font-family: -apple-system, system-ui, Arial, sans-serif; }
      #wrap { text-align:center; width:100%; height:100%; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:24px; padding:20px; }
      button { font-size:48px; padding:24px 36px; border-radius:999px; border:none; background:#fff; }
      video { width:100%; height:auto; max-height:80vh; display:none; }
      .hint { color:#aaa; font-size:16px; max-width:720px; line-height:1.4; }
      .err { color:#ffcece; }
    </style>
  </head>
  <body>
    <div id="wrap">
      <button id="playBtn">‚ñ∂Ô∏è Play Today‚Äôs Video</button>
      <video id="v" controls playsinline></video>
      <div class="hint">Videos come from your Google Drive folder ‚ÄúFrom Dad‚Äù</div>
      <div class="err" id="error"></div>
    </div>
    <script>
      // üëá Fill these in:
      const DRIVE_API_KEY = "AIzaSyDp0518xl10qVJVRf3w9Y2nLqv61YvJpKE";
      const FOLDER_ID = "11NvJiQFG-vveKXBQ6jXzdlTtFQt0vlQX";

      const b = document.getElementById('playBtn');
      const v = document.getElementById('v');
      const errorEl = document.getElementById('error');

      async function getLatestDriveVideo() {
        const q = encodeURIComponent(`'${FOLDER_ID}' in parents and trashed = false and mimeType contains 'video/'`);
        const fields = encodeURIComponent("files(id,name,modifiedTime)");
        const url = `https://www.googleapis.com/drive/v3/files?q=${q}&orderBy=modifiedTime%20desc&pageSize=1&fields=${fields}&key=${DRIVE_API_KEY}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Drive list failed: " + res.status);
        const data = await res.json();
        if (!data.files || !data.files.length) throw new Error("No videos found.");
        const f = data.files[0];
        return `https://www.googleapis.com/drive/v3/files/${f.id}?alt=media&key=${DRIVE_API_KEY}`;
      }

      b.addEventListener('click', async () => {
        try {
          const src = await getLatestDriveVideo();
          v.src = src + "&t=" + Date.now(); // cache-bust
          v.style.display = 'block';
          b.style.display = 'none';
          await v.play();
        } catch (e) {
          errorEl.textContent = e.message;
        }
      });

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js').catch(() => {});
        });
      }
    </script>
  </body>
</html>

